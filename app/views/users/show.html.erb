<div class="container mt-4">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="card-profile p-4 shadow-sm">
        <h2 class="card-title text-center mb-4">
          <%= current_user == @user ? "Meu Perfil" : "Perfil" %>
        </h2>

        <div class="text-center mb-4">
          <% if @user.profile_picture.attached? %>
            <%= image_tag url_for(@user.profile_picture), class: "rounded-circle border border-primary", style: "width: 150px; height: 150px; object-fit: cover;" %>
          <% else %>
            <%= image_tag "placeholder_profile.png", class: "rounded-circle border", style: "width: 150px; height: 150px; object-fit: cover;" %>
          <% end %>

          <div class="mt-4 mb-4">
            <p class="mb-1 fs-6"><strong>Usuário:</strong> <%= @user.username.presence || @user.email %></p>
            <p class="mb-0 fs-6"><strong>Tipo:</strong> <%= @user.owner? ? "Restaurante" : "Cliente" %></p>
          </div>

        <div class="text-center">
          <% if current_user == @user %>
            <%= link_to "Editar perfil", edit_user_path(@user), class: "btn btn-outline-secondary mt-3" %>
          <% else %>
            <% if current_user.following?(@user) %>
              <%= button_to "Deixar de seguir", friendship_path(@user), method: :delete, class: "btn btn-outline-danger mt-3" %>
            <% else %>
              <%= button_to "Seguir", friendships_path(friend_id: @user.id), method: :post, class: "btn btn-primary mt-3" %>
            <% end %>
          <% end %>

        <hr>
        
          <% tab_label =
            if @user.owner?
              "Meus restaurantes"
            else
              (current_user == @user ? "Minhas publicações" : "Publicações")
            end %>

          <ul class="nav nav-tabs mb-3 mt-4">
            <li class="nav-item">
              <%= link_to tab_label,
                publications_user_path(@user),
                class: "nav-link #{current_page?(publications_user_path(@user)) ? "active" : ""}" %>
            </li>

            <li class="nav-item">
              <%= link_to "Fotos",
                user_path(@user),
                class: "nav-link #{current_page?(user_path(@user)) ? "active" : ""}" %>
            </li>

            <li class="nav-item">
              <%= link_to "Seguidores", followers_user_path(@user), class: "nav-link" %>
            </li>

            <li class="nav-item">
              <%= link_to "Seguindo", following_user_path(@user), class: "nav-link" %>
            </li>
          </ul>

          <hr>
        </div>
      </div>
    </div>
  </div>
</div>

<h3 class="profile-posts-title">Fotos</h3>

<% if @posts.blank? %>
  <div class="profile-posts-section">
    <p class="text-muted text-center">Ainda não há publicações.</p>
  </div>
<% else %>
  <div class="profile-photo-grid">
    <% @posts.each do |post| %>
      <% thumb =
        if post.photos.attached?
          post.photos.first
        elsif post.restaurant&.photo&.attached?
          post.restaurant.photo
        elsif post.restaurant&.image_name.present?
          post.restaurant.image_name
        end %>

      <% next if thumb.blank? %>

      <%= link_to post_path(post), class: "profile-photo-link" do %>
        <%= image_tag thumb, class: "profile-photo" %>
      <% end %>
    <% end %>
  </div>
<% end %>
