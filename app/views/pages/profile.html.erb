<div class="profile-page">
  <div class="profile-card">

    <h2 class="profile-title text-center mb-4">Meu Perfil</h2>

    <!-- FOTO + INFO -->
    <div class="profile-header text-center">
      <% if current_user.profile_picture.attached? %>
        <%= image_tag url_for(current_user.profile_picture),
              class: "profile-avatar" %>
      <% else %>
        <%= image_tag "placeholder_profile.png",
              class: "profile-avatar" %>
      <% end %>

      <p><strong>Usuário:</strong> <%= current_user.username || current_user.email %></p>
      <p><strong>Tipo:</strong> <%= current_user.owner? ? "Restaurante" : "Cliente" %></p>
    </div>

    <div class="text-center mb-3">
      <%= link_to "Editar perfil", edit_user_path(@user),
            class: "btn btn-outline-secondary btn-sm" %>
    </div>

    <hr>

        <!-- BOTÕES / ABAS -->
<div class="profile-tabs-wrapper">
  <div class="profile-tabs-card">

    <%= link_to "Minhas publicações",
          "#posts",
          class: "profile-tab-btn active" %>

    <%= link_to "Fotos",
          "#photos",
          class: "profile-tab-btn" %>

    <%= link_to "Seguidores",
          followers_user_path(@user),
          class: "profile-tab-btn followers" %>

    <%= link_to "Seguindo",
          following_user_path(@user),
          class: "profile-tab-btn following" %>

  </div>
</div>

    <hr>

    <!-- AVALIAÇÕES -->
    <% @ratings_by_category.each do |category, ratings| %>
      <h4 class="profile-section-title"><%= category %></h4>

      <% ratings.group_by(&:restaurant).each do |restaurant, restaurant_ratings| %>
        <div class="profile-rating-card">
          <h5><%= restaurant.name %></h5>
          <ul>
            <% restaurant_ratings.each do |rating| %>
              <li>
                <strong><%= rating.score %>/5</strong>
                <% if rating.recommended == true %> (Recomendo)<% end %>
                <% if rating.recommended == false %> (Não recomendo)<% end %>
              </li>
            <% end %>
          </ul>
        </div>
      <% end %>
    <% end %>

    <hr>

    <!-- PUBLICAÇÕES -->
    <h3 class="profile-posts-title" id="posts">Minhas publicações</h3>

    <div class="profile-posts-section">
      <% @posts.each do |post| %>
        <div class="profile-post-row">
          <div class="profile-post-main">
            <% if post.photos.attached? %>
              <%= image_tag post.photos.first, class: "profile-post-thumb" %>
            <% elsif post.restaurant&.image_name.present? %>
              <%= image_tag post.restaurant.image_name, class: "profile-post-thumb" %>
            <% end %>

            <div class="profile-post-text">
              <strong><%= post.restaurant&.name || "Sem restaurante" %></strong>
              <p><%= post.caption %></p>
            </div>
          </div>

          <%= button_to "Excluir",
                post_path(post),
                method: :delete,
                data: { confirm: "Tem certeza que deseja excluir esta publicação?" },
                class: "profile-post-delete" %>
        </div>
      <% end %>
    </div>

  </div>
</div>
