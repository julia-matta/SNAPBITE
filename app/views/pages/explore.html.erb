<div class="explore-page">

  <h1> Explorar restaurantes</h1>
  <h4> Descubra novos sabores pela cidade </h4>

  <%= form_with url: explore_path, method: :get, local: true do %>
    <div class="row mb-3">
      <div class="col">
        <%= label_tag :query, "Buscar" %>
        <%= text_field_tag :query,
              params[:query],
              class: "form-control",
              placeholder: "Nome, infos, endere√ßo..."
            %>
      </div>

      <div class="col">
        <%= label_tag :max_price, "Pre√ßo m√©dio at√© (R$)" %>

        <% price_options = [
          ["Sem limite", ""],
          ["At√© R$ 50", 50],
          ["At√© R$ 100", 100],
          ["At√© R$ 150", 150],
          ["At√© R$ 200", 200]
        ] %>

        <%= select_tag :max_price,
              options_for_select(price_options, params[:max_price]),
              class: "form-select"
            %>
      </div>
    </div>

    <!-- BOT√ÉO "Todas" -->
    <div class="category-buttons mb-3">
      <%= button_tag type: :submit,
        name: :category,
        value: "",
        class: "category-btn #{'active' if params[:category].blank?}" do %>
         Todas
       <% end %>
    </div>

    <!-- CATEGORIAS DIN√ÇMICAS -->
    <div class="category-buttons mb-3">
      <% Restaurant::CATEGORIES.each do |cat| %>
        <% active = params[:category] == cat %>

        <%= button_tag type: :submit,
              name: :category,
              value: cat,
              class: "category-btn #{'active' if active}" do %>
          <%= cat %>
        <% end %>
      <% end %>
    </div>

    <%= submit_tag "Filtrar", class: "btn-filtrar" %>
  <% end %>

  <!-- RESULTADOS DE RESTAURANTES ‚Üí CARDS -->
  <div class="explore-results">
    <% @restaurants.each do |restaurant| %>
      <div class="explore-card">

        <!-- IMAGEM -->
        <div class="explore-card-image">
          <%= image_tag restaurant.image_name, alt: restaurant.name, class: "card-photo" %>
        </div>

        <!-- CONTE√öDO -->
        <div class="explore-card-content">

          <!-- NOME -->
          <h3 class="restaurant-name"><%= restaurant.name %></h3>

          <!-- PRE√áO M√âDIO -->
          <% if restaurant.average_price.present? %>
            <p class="restaurant-price">üíµ Pre√ßo m√©dio: R$ <%= restaurant.average_price %></p>
          <% end %>

          <!-- CATEGORIA -->
          <p class="restaurant-category">üçΩÔ∏è <%= restaurant.category %></p>

          <!-- CHECK-INS + COMENT√ÅRIOS -->
          <div class="restaurant-stats">
            <div class="stat-item">
              <i class="fas fa-map-marker-alt"></i>
              <span><%= restaurant.checkins.count %> <%= "check-in".pluralize(restaurant.checkins.count) %></span>
            </div>

            <div class="stat-item">
              <i class="fas fa-comment"></i>
              <span><%= restaurant.ratings.count %> <%= "coment√°rio".pluralize(restaurant.ratings.count) %></span>
            </div>
          </div>

          <!-- BOT√ÉO DE CHECK-IN -->
          <div class="explore-card-actions">
            <% if user_signed_in? %>
              <%= button_to "Fazer check-in", restaurant_checkins_path(restaurant), method: :post, class: "btn btn-sm btn-checkin" %>
            <% else %>
              <%= link_to "Entrar para fazer check-in", new_user_session_path, class: "btn btn-sm btn-checkin" %>
            <% end %>
          </div>

        </div>

      </div>
    <% end %>
  </div>

</div>
