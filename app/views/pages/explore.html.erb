<% content_for :title, "SnapBite - Explore restaurantes no mapa" %>

<div class="explore-page">
  <div class="explore-container">

    <div class="explore-search-card mb-5">

      <!-- ===== HEADER (t√≠tulo + bot√£o √† direita) ===== -->
      <div class="explore-search-header mb-4">
        <div class="explore-search-titles">
          <h1>Explorar restaurantes</h1>
          <h4>Descubra novos sabores pela cidade</h4>
        </div>

        <%= link_to "Buscar pessoas",
              users_path,
              class: "btn btn-outline-primary btn-search-people" %>
      </div>
      <!-- ===== FIM HEADER ===== -->

      <!-- ===== FILTROS ===== -->
      <%= form_with url: explore_path, method: :get, local: true do %>

        <!-- BUSCA + PRE√áO + FILTRAR -->
        <div class="filter-row mb-4">

          <div class="filter-field">
            <%= label_tag :query, "Buscar" %>
            <%= text_field_tag :query,
                  params[:query],
                  class: "form-control form-control-sm",
                  placeholder: "Nome, infos, endere√ßo..." %>
          </div>

          <div class="filter-field small">
            <%= label_tag :max_price, "Pre√ßo at√© (R$)" %>
            <%= select_tag :max_price,
                  options_for_select(@price_options, params[:max_price]),
                  class: "form-select form-select-sm" %>
          </div>

          <div class="filter-action">
            <%= submit_tag "Filtrar", class: "btn btn-filtrar" %>
          </div>

        </div>

        <!-- CATEGORIAS -->
        <div class="category-buttons mb-4">
          <% Restaurant::CATEGORIES.each do |cat| %>
            <%= button_tag cat,
                  type: :submit,
                  name: :category,
                  value: cat,
                  class: "category-btn #{'active' if params[:category] == cat}" %>
          <% end %>
        </div>

      <% end %>
      <!-- ===== FIM FILTROS ===== -->

    </div>

    <!-- ===== RESULTADOS ===== -->
    <div class="explore-results">
      <% @restaurants.each do |restaurant| %>

        <div class="explore-card">

          <!-- IMAGEM -->
          <div class="explore-card-image" style="position: relative;">
            <% if restaurant.photo.attached? %>
              <%= image_tag url_for(restaurant.photo),
                    class: "card-photo",
                    alt: restaurant.name %>
            <% elsif restaurant.image_name.present? %>
              <%= image_tag restaurant.image_name,
                    class: "card-photo",
                    alt: restaurant.name %>
            <% else %>
              <%= image_tag "placeholder_profile.png",
                    class: "card-photo",
                    alt: "Imagem n√£o dispon√≠vel" %>
            <% end %>

              <% if user_signed_in? && current_user.owner? && restaurant.user_id == current_user.id %>
                <%= button_to "Excluir",
                      restaurant_path(restaurant),
                      method: :delete,
                      data: { turbo_confirm: "Tem certeza que deseja excluir este restaurante?" },
                      class: "btn btn-sm btn-outline-danger",
                      form: { class: "d-inline" },
                      style: "position:absolute; top:10px; right:12px; padding:2px 6px; font-size:12px; line-height:1; z-index:5;" ,
                      aria: { label: "Excluir restaurante" } %>
              <% end %>

          </div>

          <!-- CONTE√öDO -->
          <div class="explore-card-content">

            <h3 class="restaurant-name"><%= restaurant.name %></h3>

            <% if restaurant.average_price.present? %>
              <p class="restaurant-price">
                üíµ Pre√ßo m√©dio: R$ <%= restaurant.average_price %>
              </p>
            <% end %>

            <p class="restaurant-category">
              üçΩÔ∏è <%= restaurant.category %>
            </p>

            <div class="restaurant-stats">
              <div class="stat-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>
                  <%= restaurant.checkins.count %>
                  <%= "check-in".pluralize(restaurant.checkins.count) %>
                </span>
              </div>

              <div class="stat-item">
                <i class="fas fa-comment"></i>
                <span>
                  <%= restaurant.ratings.count %>
                  <%= "coment√°rio".pluralize(restaurant.ratings.count) %>
                </span>
              </div>
            </div>

            <div class="explore-card-actions">
              <% if user_signed_in? %>
                <%= link_to "Avaliar",
                      new_post_path(restaurant_id: restaurant.id),
                      class: "btn btn-sm btn-checkin" %>
              <% else %>
                <%= link_to "Entrar para fazer check-in",
                      new_user_session_path,
                      class: "btn btn-sm btn-checkin" %>
              <% end %>
            </div>

          </div>
        </div>

      <% end %>
    </div>
    <!-- ===== FIM RESULTADOS ===== -->

  </div>
</div>
