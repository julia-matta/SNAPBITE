<div class="container mt-4">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="card-profile p-4 shadow-sm">
        <h2 class="card-title text-center mb-4">
          <%= current_user == @user ? "Meu Perfil" : "Perfil" %>
        </h2>

        <div class="text-center mb-4">
          <% if @user.profile_picture.attached? %>
            <%= image_tag url_for(@user.profile_picture), class: "rounded-circle border border-primary", style: "width: 150px; height: 150px; object-fit: cover;" %>
          <% else %>
            <%= image_tag "placeholder_profile.png", class: "rounded-circle border", style: "width: 150px; height: 150px; object-fit: cover;" %>
          <% end %>

          <p><strong>Usuário:</strong> <%= @user.username.presence || @user.email %></p>
          <p><strong>Tipo:</strong> <%= @user.owner? ? "Restaurante" : "Cliente" %></p>
        </div>

        <hr>

        <div class="text-center">
          <% if current_user == @user %>
            <%= link_to "Editar perfil", edit_user_path(@user), class: "btn btn-outline-secondary mt-3" %>
          <% else %>
            <% if current_user.following?(@user) %>
              <%= button_to "Deixar de seguir", friendship_path(@user), method: :delete, class: "btn btn-outline-danger mt-3" %>
            <% else %>
              <%= button_to "Seguir", friendships_path(friend_id: @user.id), method: :post, class: "btn btn-primary mt-3" %>
            <% end %>
          <% end %>

          <ul class="nav nav-tabs mb-3 mt-4">
            <li class="nav-item">
              <%= link_to (current_user == @user ? "Minhas publicações" : "Publicações"),
                publications_user_path(@user),
                class: "nav-link active" %>
            </li>

            <li class="nav-item">
              <%= link_to "Fotos", user_path(@user), class: "nav-link" %>
            </li>

            <li class="nav-item">
              <%= link_to "Seguidores", followers_user_path(@user), class: "nav-link" %>
            </li>

            <li class="nav-item">
              <%= link_to "Seguindo", following_user_path(@user), class: "nav-link" %>
            </li>
          </ul>

          <hr>
        </div>
      </div>
    </div>
  </div>
</div>

<h3 class="profile-posts-title"><%= current_user == @user ? "Minhas publicações" : "Publicações" %></h3>

<% if @posts.blank? %>
  <div class="profile-posts-section">
    <p class="text-muted">Ainda não há publicações.</p>
  </div>
<% else %>
  <div class="container" style="max-width: 900px;">
    <% @posts.each do |post| %>
      <% text =
        if post.respond_to?(:caption)
          post.caption
        elsif post.respond_to?(:content)
          post.content
        end %>

      <div class="card mb-3 p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div>
            <% if post.restaurant.present? %>
              <strong><%= post.restaurant.name %></strong>
            <% end %>
          </div>

          <div class="d-flex align-items-center gap-3">
            <small class="text-muted"><%= time_ago_in_words(post.created_at) %> atrás</small>

            <% if current_user == @user %>
              <%= button_to "Excluir",
                post_path(post),
                method: :delete,
                data: { turbo_confirm: "Tem certeza que deseja excluir esta publicação?" },
                class: "btn btn-link text-danger p-0",
                form: { class: "d-inline" } %>
            <% end %>
          </div>
        </div>

        <% if post.photos.attached? %>
          <%= link_to post_path(post) do %>
            <%= image_tag post.photos.first, class: "w-100 d-block mb-2", style: "border-radius: 18px; object-fit: cover;" %>
          <% end %>
        <% end %>

        <% if text.present? %>
          <p class="mb-2"><%= text %></p>
        <% end %>

        <%= link_to "Ver publicação", post_path(post), class: "btn btn-outline-secondary btn-sm" %>
      </div>
    <% end %>
  </div>
<% end %>
