<div class="explore-page">

  <h1> Explorar restaurantes</h1>
  <h4> Descubra novos sabores pela cidade </h4>

  <%= form_with url: explore_path, method: :get, local: true do %>
    <div class="row mb-3">
      <div class="col">
        <%= label_tag :query, "Buscar" %>
        <%= text_field_tag :query,
              params[:query],
              class: "form-control",
              placeholder: "Nome, infos, endereço..."
            %>
      </div>

      <div class="col">
        <%= label_tag :max_price, "Preço médio até (R$)" %>

        <% price_options = [
          ["Sem limite", ""],
          ["Até R$ 50", 50],
          ["Até R$ 100", 100],
          ["Até R$ 150", 150],
          ["Até R$ 200", 200]
        ] %>

        <%= select_tag :max_price,
              options_for_select(price_options, params[:max_price]),
              class: "form-select"
            %>
      </div>
    </div>

    <!-- BOTÃO "Todas" -->
    <div class="category-buttons mb-3">
      <%= button_tag type: :submit,
        name: :category,
        value: "",
        class: "category-btn #{'active' if params[:category].blank?}" do %>
         Todas
       <% end %>
    </div>

    <!-- CATEGORIAS DINÂMICAS -->
    <div class="category-buttons mb-3">
      <% Restaurant::CATEGORIES.each do |cat| %>
        <% active = params[:category] == cat %>

        <%= button_tag type: :submit,
              name: :category,
              value: cat,
              class: "category-btn #{'active' if active}" do %>
          <%= cat %>
        <% end %>
      <% end %>
    </div>

    <%= submit_tag "Filtrar", class: "btn-filtrar" %>
  <% end %>

  <!-- RESULTADOS DE RESTAURANTES → CARDS -->
  <div class="explore-results">
    <% @restaurants.each do |restaurant| %>
      <div class="explore-card">

        <!-- IMAGEM -->
        <div class="explore-card-image">
          <% if restaurant.photo.attached? %>
            <%= image_tag restaurant.photo, alt: restaurant.name %>
          <% else %>
            <%= image_tag "placeholder.jpg", alt: "Sem foto" %>
          <% end %>
        </div>


        <!-- CONTEÚDO -->
        <div class="explore-card-content">
          <h3><%= restaurant.name %></h3>

          <% if restaurant.average_price.present? %>
            <p class="price">Preço médio: R$ <%= restaurant.average_price %></p>
          <% end %>

          <p class="address"><%= restaurant.address %></p>

          <%= link_to "Ver detalhes", restaurant_path(restaurant), class: "btn-explore" %>
        </div>

      </div>
    <% end %>
  </div>

</div>
